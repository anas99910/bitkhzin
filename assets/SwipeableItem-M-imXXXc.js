import{i as z,g as E,h as F,a as m,M,k as v,l as L,n as P,o as I,p as B,s as D,q as j,t as V,v as A,w as g,x as S,y as O,z as R,D as U,E as b,F as W,G as _,H as $,I as G,J,K,j as p,m as x,f as N,N as Q}from"./index-vpsI0Pgs.js";function X(...t){const o=!Array.isArray(t[0]),e=o?0:-1,r=t[0+e],s=t[1+e],a=t[2+e],l=t[3+e],f=z(s,a,l);return o?f(r):f}function H(t){const o=E(()=>F(t)),{isStatic:e}=m.useContext(M);if(e){const[,r]=m.useState(t);m.useEffect(()=>o.on("change",r),[])}return o}function k(t,o){const e=H(o()),r=()=>e.set(o());return r(),v(()=>{const s=()=>L.preRender(r,!1,!0),a=t.map(l=>l.on("change",s));return()=>{a.forEach(l=>l()),P(r)}}),e}function Y(t){I.current=[],t();const o=k(I.current,t);return I.current=void 0,o}function w(t,o,e,r){if(typeof t=="function")return Y(t);const s=typeof o=="function"?o:X(o,e,r);return Array.isArray(t)?T(t,s):T([t],([a])=>s(a))}function T(t,o){const e=E(()=>[]);return k(t,()=>{e.length=0;const r=t.length;for(let s=0;s<r;s++)e[s]=t[s].get();return o(e)})}function Z(t){t.values.forEach(o=>o.stop())}function C(t,o){[...o].reverse().forEach(r=>{const s=t.getVariant(r);s&&D(t,s),t.variantChildren&&t.variantChildren.forEach(a=>{C(a,o)})})}function tt(t,o){if(Array.isArray(o))return C(t,o);if(typeof o=="string")return C(t,[o]);D(t,o)}function ot(){const t=new Set,o={subscribe(e){return t.add(e),()=>{t.delete(e)}},start(e,r){const s=[];return t.forEach(a=>{s.push(B(a,e,{transitionOverride:r}))}),Promise.all(s)},set(e){return t.forEach(r=>{tt(r,e)})},stop(){t.forEach(e=>{Z(e)})},mount(){return()=>{o.stop()}}};return o}function et(){const t=E(ot);return v(t.mount,[]),t}const st=et,rt=()=>{const{userProfile:t}=j(),[o,e]=m.useState([]);return m.useEffect(()=>{if(!t?.householdId)return;(async()=>{try{const a=V(A(g,"shopping-history"),S("householdId","==",t.householdId),O("count","desc"),R(15)),f=(await U(a)).docs.map(n=>({id:n.id,...n.data()}));e(f)}catch(a){console.error("Error fetching history:",a)}})()},[t?.householdId]),{frequentItems:o,addToHistory:async(s,a)=>{if(!t?.householdId||!s.trim())return;const l=s.trim(),f=`${t.householdId}_${l.toLowerCase().replace(/\s+/g,"-")}`;try{const n=b(g,"shopping-history",f);await W(n,{householdId:t.householdId,text:l,category:a,count:_(1),lastUsed:Date.now()},{merge:!0})}catch(n){console.error("Error adding to history:",n)}}}},at=()=>{const[t,o]=m.useState([]),{user:e,userProfile:r}=j();m.useEffect(()=>{if(!e||!r?.householdId){o([]);return}const n=V(A(g,"shopping-list"),S("householdId","==",r.householdId)),u=$(n,c=>{const i=c.docs.map(d=>({id:d.id,...d.data()}));i.sort((d,h)=>h.createdAt-d.createdAt),o(i)},c=>{console.error("Error fetching shopping list:",c)});return()=>u()},[e,r?.householdId]);const{addToHistory:s}=rt();return{todos:t,addTodo:async(n,u=1,c="Other")=>{if(!n.trim()||!e||!r?.householdId)return;const i=Date.now().toString(),d={id:i,text:n,completed:!1,quantity:u,category:c,createdAt:Date.now()};o(h=>[d,...h]),s(n,c);try{await K(A(g,"shopping-list"),{text:n,userId:e.uid,householdId:r.householdId,completed:!1,quantity:u,category:c,createdAt:Date.now()})}catch(h){console.error("Error adding item:",h),o(y=>y.filter(q=>q.id!==i)),alert("Failed to add item. Please check your connection.")}},toggleTodo:async n=>{const u=t.find(c=>c.id===n);if(u){o(c=>c.map(i=>i.id===n?{...i,completed:!i.completed}:i));try{await J(b(g,"shopping-list",n),{completed:!u.completed})}catch(c){console.error("Error toggling item:",c),o(i=>i.map(d=>d.id===n?{...d,completed:u.completed}:d))}}},deleteTodo:async n=>{const u=t.find(c=>c.id===n);if(u){o(c=>c.filter(i=>i.id!==n));try{await G(b(g,"shopping-list",n))}catch(c){console.error("Error deleting item:",c),o(i=>{const d=[...i,u];return d.sort((h,y)=>y.createdAt-h.createdAt),d}),alert("Failed to delete item. Check console for details.")}}}}},ct=({children:t,onSwipeLeft:o,onSwipeRight:e,threshold:r=80,disabled:s})=>{const a=st(),l=H(0),f=w(l,[-50,0,50],[1,0,1]),n=w(l,[-50,0,50],[0,0,1]),u=w(l,[-50,0,50],[1,0,0]),c=async(i,d)=>{if(s)return;const h=d.offset.x,y=d.velocity.x;e&&(h>r||y>400)?(e(),await a.start({x:0,opacity:1,transition:{type:"spring",stiffness:300,damping:25}})):o&&(h<-r||y<-400)?(await a.start({x:-500,opacity:0}),o()):a.start({x:0,opacity:1})};return p.jsxs("div",{style:{position:"relative",overflow:"hidden",touchAction:"pan-y"},children:[p.jsxs(x.div,{style:{position:"absolute",inset:0,display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0 20px",borderRadius:"var(--radius-md)",backgroundColor:"var(--color-surface)",opacity:f},children:[p.jsxs(x.div,{style:{display:"flex",alignItems:"center",gap:"8px",color:"#10b981",fontWeight:"bold",opacity:n},children:[p.jsx(N,{size:24}),p.jsx("span",{children:"Complete"})]}),p.jsxs(x.div,{style:{display:"flex",alignItems:"center",gap:"8px",color:"#ef4444",fontWeight:"bold",opacity:u},children:[p.jsx("span",{children:"Delete"}),p.jsx(Q,{size:24})]})]}),p.jsx(x.div,{drag:s?!1:"x",dragConstraints:{left:0,right:0},dragElastic:.7,onDragEnd:c,animate:a,style:{x:l,position:"relative",zIndex:10,cursor:s?"default":"grab",touchAction:"pan-y"},whileTap:{cursor:s?"default":"grabbing"},children:t})]})};export{ct as S,rt as a,at as u};
